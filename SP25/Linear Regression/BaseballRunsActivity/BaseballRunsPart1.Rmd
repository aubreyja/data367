---
title: "Exploring Some Ideas from Bill James"
author: "Dr. Ekstrom, Abrielle Agron"
fontsize: 11pt
output:
  pdf_document: default
  html_notebook: default
---

\begin{description}
\item[Purpose:] Each activity illustrates a little sports analytics, a little statistics and a little {\em R}.
  \begin{description}
    \item[Sports Analytics:] Try to explain how runs are scored in Baseball, that is, to try to find a statistic that explains as much run scoring as possible.
    \item[Statistics:] regression
    \item[R:] Introduction to {\em R}, including: reading a csv, using a notebook, linear modeling, and plotting. 
  \end{description}
\end{description}

\noindent{\bf Demonstration - Runs Scored and Homeruns:} 
In this demonstration, we are going to examine the relationship between the number of
homeruns hit and the number of runs scored. Using function terms, we will consider 
homeruns as the independent variable and runs as the dependent variable. Using
statistical terms, homeruns is called the explanatory variable and runs is the response
variable.\footnote{It may seem arbitrary that we picked runs to be the response variable,
but it is not. Ultimately, the goal of offense in baseball is to score as many runs as
possible. We are trying to understand how runs are scored - or what statistic best
explains how runs are scored - is it homeruns? batting average? or stolen bases? or
something else?}  

The data given in \texttt{BaseballRuns.csv}  shows 
offensive statistics for MLB teams from 2000-2005. Import the data \texttt{BaseballRuns.csv} into \textit{R} using
```{r}
bbr=data=read.csv("BaseballRuns.csv")
```
The table of data is now in a data frame\footnote{Think of a data frame as an array on steriods - where
the entries of the array can be objects more complicated than just numbers or strings} 
called \texttt{bbr}. 

We can get a summary of what is in this data frame:
```{r}
summary(bbr)
```

The variables are:
\begin{description}
		\item[\tt lg:] league - AL for American League and NL for National League
		\item[\tt team:] city of team (three letter abbreviation)
		\item[\tt G:] number of games played (162 is normal)
		\item[\tt Ghome:] number of home games played (81 is normal)
		\item[\tt W:] number of wins
		\item[\tt L:] number of losses
		\item[\tt R:] number of runs scored
		\item[\tt AB:] number of at bats
		\item[\tt X1B:] number of singles 
		\item[\tt X2B:] number of doubles 
		\item[\tt X3B:] number of triples 
		\item[\tt HR:] number of homeruns
		\item[\tt BB:] number of walks
		\item[\tt SO:] number of strike outs 
		\item[\tt SB:] number of stolen bases
		\item[\tt CS:] number of times caught stealing
		\item[\tt HBP:] number of batters hit by pitch 
		\item[\tt SF:] number of sacrifice flies
	\end{description}

\pagebreak

\noindent \textsc{Creating and Plotting a Linear Model:}

To plot \texttt{R} versus \texttt{HR}
```{r}
plot(bbr$HR,bbr$R,xlab="Homeruns",ylab="Runs")
```

To create the ``best-fitting line'' for this data: 
```{r}
g=lm(formula=R~HR, data = bbr)
```
which stores this line - and much information about this line - in the variable \texttt{g}.
To see the intercept and slope of this line, simply type:
```{r}
g
```

To add this line to the plot:
```{r}
plot(bbr$HR,bbr$R,xlab="Homeruns",ylab="Runs")
abline(g,col="red")
```

\pagebreak

\noindent \textsc{What Do We Mean by ``Best-Fitting Line''?}

The equation for this best fitting line is
\[ {\tt R} = 452.358+1.815 \cdot {\tt HR} \]
We can use this equation (model) to predict how many runs a team scored based on 
how many homeruns they hit.  For example, the 2000 Anaheim Angels (\texttt{ANA})
hit 236 homeruns, so our model predicts they scored 880.698 runs. They actually
scored 864 runs. The difference between the predicted number of runs and the
actual number of runs is called a residual. In this case, the residual is 16.698.
We can use \textit{R} to calculate the predicted number of runs scored for each team
```{r}
Pred=452.358+1.814*bbr$HR
```

and the residual for each team 
```{r}
Resid=Pred-bbr$R
```

A ``best-fitting'' line should somehow minimize these residuals - and our line actually 
minimizes the (sum of the) squares of the residuals - which is why it is often called the 
least-squares line.\footnote{You can calculate the sum of the squares of the residuals\\
{\tt sum(Resid*Resid)} \\
Now try a different line, such as
\[ {\tt R} = 410+2 \cdot {\tt HR} \]
and calculate the predicted values for runs and their residuals \\
{\tt Pred2=410+2.0*HR}  \\
{\tt Resid2=Pred2-R} \\
{\tt sum(Resid2*Resid2)}  \\
The sum of the squares for these residuals will be more than the sum of the squares
of the residuals for our original model.}
It is also called the regression line.

\noindent \textsc{Important Info Regarding This Linear Model:}

To get more details about our best-fitting line: 
```{r}
summary(g)
```

A couple of things to note in this summary: the $R$-squared value
(given in the output as \texttt{Multiple R-squared}) of 0.5177. This means that
51.77\% of the variation in runs can be explained by the number of homeruns.
The second is the Residual standard error is 58.18. This gives us an idea
of the size of the average residual - for our purposes you can think of it
as the standard deviation of the residuals. For example, we would expect
95\% of residuals to be within the interval
$(-2 \cdot 58.18, 2 \cdot 58.18)$. 

\pagebreak

\noindent \textsc{Group Activity:}

Consider the statistics:
\begin{description}
  \item[\tt BA:] batting average - which is: 
			\( \displaystyle \frac{ {\tt X1B} + {\tt X2B}+ {\tt X3B}+  {\tt HR}}{  {\tt AB} } \)
  \item[\tt SLG:] slugging percentage - which is: 
			\( \displaystyle \frac{ {\tt X1B} + 2 \cdot  {\tt X2B}+ 3 \cdot {\tt X3B}+ 4 \cdot {\tt HR}}{  {\tt AB} } \)
  \item[\tt OBP:] on-base percentage - which is: 
			\( \displaystyle \frac{ {\tt X1B} + {\tt X2B}+ {\tt X3B}+  {\tt HR} + {\tt BB} + 
				{\tt HBP}}{  {\tt AB}+ {\tt BB} + {\tt HBP} + {\tt SF}} \)
  \item[\tt OPS:] on-base plus slugging - which is: {\tt OBP} + {\tt SLG}
\end{description}
Determine the best fit linear model for each of the following:
runs versus batting average, runs versus slugging percentage, runs versus on-base
percentage, and runs versus on-base plus slugging percentage.
Be sure each model includes the equation that predicts the number runs scored, the $R$-squared value, and the Residual standard error.

Use \textit{R} to compute these new statistics. For example
```{r}
bbr$BA=(bbr$X1B+bbr$X2B+bbr$X3B+bbr$HR)/bbr$AB
```

Now you can use the variable \texttt{BA} to compute your linear model.

Turn in your \textit{R} notebook in the appropriate assignment folder on Gradescope.

\noindent When Youâ€™re Done

Consider the following questions:
\begin{itemize}
  \item What variables can I make combining these statistics to give a high R-squared value?
  \item Download more recent data from baseballreference.com. Do the R-squared values for our statistics
change dramatically?
  \item What is most predictive (based on R-squared) value that you can make with only 2 columns from
your original dataframe? What about 3 or 4?
\end{itemize}

